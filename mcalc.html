<!DOCTYPE html>
<html>
 <head>
 <title>CloudFront</title>
 <link rel="stylesheet" type="text/css" href="http://syddev.com/jquery.shadow/jquery.shadow/jquery.shadow.css">
 <link rel="stylesheet" type="text/css" href="public/resources/styles.css">
 <link rel="stylesheet" href="public/resources/libraries/jquery-ui-1.10.3.custom/css/dark-hive/jquery-ui-1.10.3.custom.css">
 <script type='text/javascript' src="/socket.io/socket.io.js"></script>
 <script src="//code.jquery.com/jquery-1.9.1.js"></script>
 <script src="http://syddev.com/jquery.shadow/jquery.shadow/jquery.shadow.js"></script>
 <script src="public/resources/libraries/jquery-ui-1.10.3.custom/js/jquery-ui-1.10.3.custom.js"></script>

<script>

//function to Validate the form
function Validate()
	{
		var isCorrect = true;
		var isNumber=true;
		var duplicate_name=false;
		var namedCorrect = true;
		var name=$('input[name=nameofmatrix]').val();
		var a11=$('#form1 input[name=a11]').val();
		var a22=$('#form1 input[name=a22]').val();
		var a12=$('#form1 input[name=a12]').val();
		var a21=$('#form1 input[name=a21]').val();
		var name_regex = /^[a-zA-Z0-9_]{1,8}$/;
		//console.log('the name is',name);
		//check for correct name characters
		namedCorrect = name_regex.test(name);
		console.log('after regex testing',namedCorrect);
		if(!namedCorrect){
			isCorrect=false;}
			
		//check for duplicate name
			$('#selectable li').each(function(){
					if($(this).text()==name){
						duplicate_name=true;
						isCorrect = false;
					}
			});
		//check for being a number	
		isNumber=isNumber&& (!isNaN(a11)) && (!(a11==null)&&(a11!=""));
		isNumber=isNumber&& (!isNaN(a22)) && (!(a22==null)&&(a22!=""));
		isNumber=isNumber&& (!isNaN(a12)) && (!(a12==null)&&(a12!=""));
		isNumber=isNumber&& (!isNaN(a21)) && (!(a21==null)&&(a21!=""));
		
		if(!isNumber){
			isCorrect=false;
			}
		
			//error reporting and return
		if(!isCorrect){
			if(!namedCorrect)
				$('#tip').html("<p style='color:red; font-size:small'>Name should only contain letters,numbers and underscores</p>");
			if(!isNumber)
				$('#tip').html("<p style='color:red; font-size:small'>matrix elements should only contain numbers</p>");
			if(duplicate_name)
				$('#tip').html("<p style='color:red; font-size:small'>Duplicate name. Please select a different name</p>");
		}
		return isCorrect;
	}
	
	
</script>
</head>

 <body>
 <style>
  #feedback { font-size: 1.4em; }
  #selectable .ui-selecting { background: #FECA40; }
  #selectable .ui-selected { background: #F39814; color: white; }
  #selectable { list-style-type: none; margin: 0; padding: 0; width: 100px; }
  #selectable li { margin: 3px; padding: 0.4em; font-size: 1.0em; height: 12px; }
  </style>
 <script>
 //creating a socket to the server
var socket = io.connect("http://localhost:3000");
/* socket.emit('test',{print:'connected to server'});
socket.on('gotcha',function(data){
		console.log('gotcha fired');
		console.log('I caught server data' + data.message);		
	}); */

 $(document).ready(function(){
 		 //define shadow
 		 $('#calc-container').shadow('raised');	 
 		 //define the "Define" "Edit" and "Help" buttons
 		 $('#button_define,#button_edit,#button_help').button({
 		 width:100});
 		 //Create selectable list
 		 $('#selectable').selectable();
 		 //Define the multiple add and equal button
 		 $('#multiply').button({
 		 		 text:false,
 		 		 icons:{
 		 		 	 primary:"ui-icon-closethick"
 		 		 	}
 		 });
 		  $('#add').button({
 		 		 text:false,
 		 		 icons:{
 		 		 	 primary:"ui-icon-plusthick"
 		 		 	}
 		 });
 		  $('#equal').button({
 		 		 text:false,
 		 		 icons:{
 		 		 	 primary:"ui-icon-grip-solid-horizontal"
 		 		 	}
 		 });
 		  //define dialogue
		$('#dialog').dialog(
			{
				width:400,
				height:300,
				autoOpen:false
			}
		);
		//edit dialogue
		$('#dialog_edit').dialog(
			{
				width:400,
				height:300,
				autoOpen:false
			}
		);
		
		$('#button_define').click(function(){
			$('#dialog').dialog('open');
			$('#tip').html("<p style='color:red; font-size:small'>All fields are mandatory</p>");
		});
		
		$('#submit_button,#cancel_button').button();
		
		$('#cancel_button').on('click',function(){
				event.preventDefault();
				$('#dialog').dialog('close');
		});
		//code for providing submit functionality
		$('#submit_button').click(function(event){
			event.preventDefault();
			var name=$('input[name=nameofmatrix]').val();
			//Validate is a function which returns a bool if validation proceeds correctly
			var isCorrect = Validate();
			if(isCorrect){
				//create an object to be submitted to client
				var spec ={
					name:$('input[name=nameofmatrix]').val(),
					a11:$('input[name=a11]').val(),
					a12:$('input[name=a12]').val(),
					a21:$('input[name=a21]').val(),
					a22:$('input[name=a22]').val(),
				};
				socket.emit('submitF',spec);
				$('#selectable').append("<li class='ui-widget-content'>"+name+"</li>");
				$('#dialog').dialog('close');
			} 
		
		});
		//code for providing edit functionality
		$('#button_edit').click(function(event){
			event.preventDefault();
			var selectedItem = -1;
			selectedItem = $('#selectable .ui-selected').text();
			console.log(selectedItem);
			
			if(selectedItem!=-1){
			//emit the event to get selected items attributes
			socket.emit('edit',selectedItem);
			
			//catch the servers response with data
			socket.on('editedMatrix',function(spec){
				console.log(spec);
				$('#dialog_edit').dialog('open');
				$('#tip').html("<p style='color:red; font-size:small'>All fields are mandatory</p>");
				$('#form2 input[name=a11]').val(spec.a11);
				$('#form2 input[name=a12]').val(spec.a12);
				$('#form2 input[name=a21]').val(spec.a21);
				$('#form2 input[name=a22]').val(spec.a22);
				
			});

			}	
		});
		//events coming from the server
		

});
</script>
<div id='calc-container' class='ui-widget ui-corner-all'>
	<!This is the button area div>
	<div id='button_area' class='ui-widget-content'>
	<button id='button_define' style='position:absolute; top: 25px; left:25px; width:100px'>Define</button>
	<button id='button_edit' style='position: absolute; top:70px; left:25px; width:100px'>Edit</button>
	<button id='button_help' style='position: absolute; top:115px; left:25px; width:100px'>Help</button>
	</div>
	<!This is the defined matrices div>
	<div id='defined_matrices' class='ui-widget-content'>
		<ul id='selectable' style="list-style-type:none; position:relative; left: 25px; top:10px">
  	</ul>
	
	</div>
	<! Display Container div starts>
	<div id='display_container' class='ui-widget-content'>
		<div id='display_pane' class='white_panes'>
		</div>
	</div>
	<! results container div starts>
	<div id='result_container' class='ui-widget-content'>
		<div id='result_pane' class='white_panes'>
		<p> result container</p>
		</div>
	</div>
	<! operations pane starts here>
	<div id='op_bar' class='ui-widget-content'>
	<button id='multiply'>X</button>
	<button id='add'>X</button>
	<button id='equal'>X</button>
	</div>
</div>
<! this is the define dialog>
<div id='dialog' title='Define New Matrix'>
	<form name='form1' id='form1'>
	<fieldset>
		<label for="Name">Name</label>
		<input type='text' name='nameofmatrix' id='Name' class='whitepanes'><br>
		<label for="a11">a11</label>
		<input type="text" name='a11' id='a11' class='whitepanes number-field'><br>
		<label for="a22">a22</label>
		<input type="text" name='a22' id='a22' class='whitepanes number-field'><br>
		<label for="a12">a12</label>
		<input type="text" name='a12' id='a12' class='whitepanes number-field'><br>
		<label for="a21">a21</label>
		<input type="text" name='a21' id='a21' class='whitepanes number-field'><br>
		<button id='submit_button'>Submit</button>
		<button id='cancel_button'>cancel</button>
	</fieldset>
	</form>
<p id='tip' style='color:red;'><i>All fields are required</i></p>
</div>

<! this is the edit dialog>
<div id='dialog_edit'>
	<form name='form2' id='form2'>
	<fieldset>
		<label for="a11">a11</label>
		<input type="text" name='a11' id='a11' class='whitepanes number-field'><br>
		<label for="a22">a22</label>
		<input type="text" name='a22' id='a22' class='whitepanes number-field'><br>
		<label for="a12">a12</label>
		<input type="text" name='a12' id='a12' class='whitepanes number-field'><br>
		<label for="a21">a21</label>
		<input type="text" name='a21' id='a21' class='whitepanes number-field'><br>
		<button id='editsubmit_button'>OK</button>
		<button id='editcancel_button'>cancel</button>
	</fieldset>
	</form>
<p id='tip' style='color:red;'><i>All fields are required</i></p>
</div>

</body>
</html>
